"use strict";(self.webpackChunk_msnews_msnews_experiences=self.webpackChunk_msnews_msnews_experiences||[]).push([["money-info-service"],{78376:function(e,t,n){n.r(t),n.d(t,{ChartFlagLightweight:function(){return ve},ChartPropsHelper:function(){return qe},CryptoBannedMarkets:function(){return f},KEY_GETMARKETMOVERS:function(){return m},addToWatchlist:function(){return Le},arrayHasData:function(){return ne},cryptocurrencyIDRegex:function(){return d},enableDisableMoneyCard:function(){return $e},financeFetchImpl:function(){return B},flattenListIfNested:function(){return ee},formatNumber:function(){return A},formatPercent:function(){return I},formatPercentChange:function(){return P},formatPrice:function(){return O},formatPriceChange:function(){return F},getAnalystRecommendation:function(){return _e},getAutoSuggest:function(){return Me},getChart:function(){return V},getChartChangePcntNumber:function(){return he},getCommonChart:function(){return J},getCryptoChart:function(){return Z},getCryptocurrencyQuoteDetailsRaw:function(){return z},getFinanceServiceUrlForSubpath:function(){return ce},getMarketMovers:function(){return Ne},getOneServiceParams:function(){return ae},getPriceFraction:function(){return Se},getQuoteDetailsRaw:function(){return W},getQuoteSummary:function(){return ke},getResponseJson:function(){return re},getShortName:function(){return pe},getSmallPrecisionNumberFormat:function(){return j},getZerosCountInDecimal:function(){return Ce},initOneServiceRequest:function(){return ie},isNotNullOrUndefined:function(){return te},moverDefaultExchangeId:function(){return l},moverExchangeIdConfig:function(){return h},notEmpty:function(){return $},transformToAnalystRecommendation:function(){return Ge}});var r=n(7476),i=n(88826),a=n(22826),s=n(76733);class o{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}async function u({action:e,ids:t,cacheStore:n,getCacheId:r,fetchData:i,getItemId:a,transformer:u}){const c=performance.now(),{results:l,uncached:h}=function(e,t,n){const r=[],i=new Map;return e.forEach((e=>{const a=n(e),s=t.get(a);if(s)r.push(s);else{const n=new o;i.set(e,n),t.set(a,n.promise),r.push(n.promise)}})),{results:r,uncached:i}}(t,n,r);s.k.logSingleObject({FinanceServiceRawCached:{action:e,usage:n.itemCount,cached:t.length-h.size,missed:h.size}},!0),await async function(e,t,n,r,i){const a=[...e.keys()];if(a.length>0){try{(await r(a)).forEach((t=>{const n=i(t);var r;n&&(null===(r=e.get(n))||void 0===r||r.resolve(t),e.delete(n))}))}catch(e){}for(const[r,i]of e.entries())i&&(i.resolve(null),t.del(n(r)))}}(h,n,r,i,a);const m=(await Promise.all(l)).filter(Boolean).map(u),f=(performance.now()-c).toFixed(2);return s.k.logSingleObject({FinanceSsrApiLatency:{duration:f,requestName:e,cache:!0,idLen:t.length}},!0),m}const c=new class{constructor(e={}){this.__cache=new Map(Object.entries(e))}get(e){return this.__cache.get(e)}set(e,t){this.__cache.set(e,t)}keys(){return Array.from(this.__cache.keys())}has(e){return this.__cache.has(e)}clear(){this.__cache.clear()}delete(e){this.__cache.delete(e)}},l="r6dwop",h={"mr-in":"r6dwoq","es-xl":"r6dwrs","ar-eg":"r6dwo2","pl-pl":"r6dwpf","tr-tr":"r6dwoe","nl-nl":"r6dwnt","cs-cz":"r6dwok","fr-fr":"r6dwov","en-ie":"r6dwo7","de-de":"r6dwo8","es-cl":"r6dwoz","fr-be":"r6dwny","nb-no":"r6dwot","fi-fi":"r6dwoa","el-gr":"r6dwnv","nl-be":"r6dwny","en-au":"r6dwnu","en-sa":"r6dwpd","th-th":"r6dwnw","en-sg":"r6dwoy","en-nz":"r6dwos","en-us":"r6dwrs","de-at":"r6dwpg","hu-hu":"r6dwok","es-mx":"r6dwon","en-za":"r6dwof","da-dk":"r6dwo4","he-il":"r6dwp7","it-it":"r6dwoo","fr-ch":"r6dwp6","fr-ca":"r6dwpb","es-es":"r6dwnm","es-pe":"r6dwrs","es-co":"r6dwrs","ar-sa":"r6dwpd","id-id":"r6dwod","zh-cn":"r6dwp2","hi-in":"r6dwoq","zh-tw":"r6dwp8","ru-ru":"r6dwnp","ru-xl":"r6dwnp","ja-jp":"r6dwpa","pt-pt":"r6dwoi","en-ae":"r6dwns","pt-br":"r6dwnn","en-gb":"r6dwok","vi-vn":"r6dwp3","es-ve":"r6dwrs","bn-in":"r6dwoq","en-ca":"r6dwpb","zh-hk":"r6dwob","es-us":"r6dwrs","ar-xl":"r6dwpd","en-ph":"r6dwow","de-ch":"r6dwp6","en-xl":"r6dwoq","es-ar":"r6dwo1","ar-ae":"r6dwns","en-my":"r6dwog","sv-se":"r6dwp4","ko-kr":"r6dwoh","en-in":"r6dwoq","te-in":"r6dwoq"},m="GetMarketMovers_",f=["zh-cn"],d=/^c[1-9a-z]{4}$/;var p=n(21789),g=n(72322),y=n(92100),v=n(98512),w=n(13334),T=n(44672),C=n(54820),S=n(15165),x=n(73666),b=n.n(x),k=n(31558),N=n(55524);let E="",D="";function A(e,t,n,r){if("number"!=typeof e||Number.isNaN(e))return"-";const i=function(){if(D===p.jG.CurrentMarket&&E)return E;let e=p.jG.CurrentMarket??g.IY.ENUS;return["ar","bn","fa","mr","ne"].some((t=>e.startsWith(t)))&&(e=g.IY.ENUS),"es-pe"===e&&(e="es"),E=e,D=p.jG.CurrentMarket,e}();let a={};if("object"==typeof t)a=t;else{if("number"==typeof t)a.minimumFractionDigits=t;else{if(!r&&Math.abs(e)<2)return j(e,i);a.minimumFractionDigits=2}a.maximumFractionDigits="number"==typeof n?n:a.minimumFractionDigits}return new Intl.NumberFormat(i,a).format(e)}const M=e=>(t,n,r)=>{if("number"!=typeof t||Number.isNaN(t))return"-";let i=e(t,n,r);return t>0&&(i="+"+i),i},O=A,F=M(O),I=(e,t,n)=>{if("number"!=typeof e||Number.isNaN(e))return"-";return A(e,t,n,!0)+"%"},P=M(I);function $(e){return null!=e}const j=(e,t)=>{let n="";const r=e.toFixed(20).match(/^-?\d*\.?0*\d{0,4}/);if(!r||!r[0])return n;const i=(n[0]/1).toLocaleString(t,{useGrouping:!1,maximumSignificantDigits:4}),a=(n[0]/1).toLocaleString(t,{useGrouping:!1,minimumFractionDigits:2});return n=e<1?i:"1"==i?a:i,n};function L(e){const t=new Date(e);if(isNaN(t.getTime()))return"";const n=t.getDate(),r=t.getMonth()+1,i=t.getUTCFullYear(),a=t.getUTCHours(),s=a<10?"0"+a:a.toString(),o=t.getUTCMinutes();return`${n}/${r}/${i} ${s}:${o<10?"0"+o:o.toString()} WEST`}const G="Finance/Charts",R="Finance/Cryptocurrency/chart",_="Finance/Quotes",q="Finance/ExchangeStatistics",H="Finance/Indices",U="Finance/Cryptocurrency/quote",X=100;async function W(e,t,n){const i=e&&e.filter((e=>e&&""!=e));if(!i||0===i.length)return[];const a=function(e,t=1){t=Math.max(t,0);const n=null==e?0:e.length;if(!n||t<1)return[];let r=0,i=0;const a=new Array(Math.ceil(n/t));for(;r<n;)a[i]=e.slice(r,r+t),r+=t,i++;return a}(Array.from(new Set(i)),X),s=await ie("GET");s.cache="no-store";const o="getQuoteDetails";return(await Promise.all(a.map((async e=>{const i=ce(_);i.search=y.c.keyValueArrayToQueryString([...y.c.getParams(p.jG.ContentServiceUrlBase.search),...ae(),...se(),{key:"ids",value:e.join(",")},{key:"wrapodata",value:"false"}]);const a=(0,T.w)((()=>B(i.href,s)),o,t,n),u=await re(a,o,i.href,r.O5R,r.Knl,r.U,ne);if(!u)return[];return ee(u)})))).reduce(((e,t)=>e.concat(t)),[])}async function z(e,t){const n=e&&e.filter((e=>e&&""!=e));if(!n||0===n.length)return[];const i=t||"",a=ce(U);a.search=y.c.keyValueArrayToQueryString([...y.c.getParams(p.jG.ContentServiceUrlBase.search),...ae(),...se(),{key:"ids",value:n.join(",")},{key:"wrapodata",value:"false"},{key:"currency",value:i}]);const s=await ie("GET");s.cache="no-store";const o="getQuoteDetails",u=(0,T.w)((()=>B(a.href,s)),o),c=await re(u,o,a.href,r.m96,r.W7q,r.jvv,ne);if(!c)return[];return ee(c)}function Q(e){return e.instrumentId}const Y=new(b())({maxAge:12e4,max:5e4,length:()=>50});async function V(e,t,n){if(t===a.oX.OneDayOneMinute)return J(e,t);const r=[],i=[];e.forEach((e=>{n.includes(e)?i.push(e):r.push(e)}));return(await Promise.allSettled([J(r,t),Z(i,t)])).reduce(((e,t)=>"fulfilled"===t.status&&t.value?[...e,...t.value]:e),[])}async function J(e,t=a.oX.OneDayOneMinute){return u({action:"getChart",ids:e,cacheStore:Y,getCacheId:e=>`${p.jG.CurrentMarket}-${e}-${t}`,fetchData:e=>K(e,t),getItemId:Q,transformer:le})}async function Z(e,t=a.oX.OneDayOneMinute){return u({action:"getCryptoChart",ids:e,cacheStore:Y,getCacheId:e=>`${p.jG.CurrentMarket}-${e}-${t}`,fetchData:e=>K(e,t,!0),getItemId:Q,transformer:me})}const B=(()=>{if((0,k.N)())return window.fetch.bind(window);{const e=800;return(t,n)=>(0,v.Sm)(t,e,n)}})();async function K(e,t,n){if(!e.length)return[];const i=ce(n?R:G),a=[...ae(),...se(),{key:"ids",value:e.join(",")},{key:"type",value:t},{key:"wrapodata",value:"false"},{key:"chartflag",value:ve.toString()}];i.search=y.c.keyValueArrayToQueryString(a);const s=await ie("GET"),o=n?"getCryptoChart":"getChart",u=(0,T.w)((()=>B(i.href,s)),o),c=await re(u,o,i.href,n?r.rrV:r.SNZ,n?r.YNO:r.TyC,n?r.vZx:r.ITJ,ne);return null==c?[]:ee(c)}function ee(e){return Array.isArray(e[0])?e.map((e=>e[0])):e}function te(e){return null!=e}function ne(e){return!!te(e)&&(e.constructor===Array&&e.length>0)}const re=async(e,t,n,r,a,s,o)=>{let u;try{u=await e}catch(e){return(0,i.H)(r,`${t} fetch failed`,`${t}, fetch failed: ${e?e.message:""}`),null}if(!u.ok)return(0,i.H)(a,`${t} http status not ok`,`${u.url}, http headers: ${JSON.stringify(u.headers)}, http status: ${u.statusText}`),null;const c=await u.json();return o(c)?c:((0,i.H)(s,`${t} response json invalid`,`${u.url}, http headers: ${JSON.stringify(u.headers)}, response json invalid, response: ${JSON.stringify(c)}`),null)};function ie(e){return C.$D.getBaseRequestData(e,{skipDualAuthHeader:!0})}function ae(){const e=(0,w.nP)().CurrentFlights;let t=e;e&&(t=e.split(",").filter((e=>e.includes("1s"))).join(","));let n="finance-utils-peregrine";return["windowsNewsPlus","winWidgets"].includes(p.jG.AppType)&&(n="winp2"),C.$D.getOneServiceParamsWithoutAuth("",n,!1,t,!0)}function se(){const e=N.Gq.get("akmprotocol");return e?[{key:"akmprotocol",value:e}]:[]}const oe="https://api.msn.com",ue="https://api.msn.cn";function ce(e,t=!0){const n=(0,S.qQ)();let r;return r=(0,k.N)()?t?n:p.jG.CurrentMarket===g.IY.ZHCN?ue:oe:oe,new URL(e+n.search,r)}function le(e){Array.isArray(e)&&(e=e[0]);const t={...e};return e.preHoursSeries&&(t.preHoursSeries=fe(e.preHoursSeries)),e.afterHoursSeries&&(t.afterHoursSeries=fe(e.afterHoursSeries)),e.series&&(t.series=fe(e.series),t.changePcntNumber=he(t.series,t.pricePreviousClose,t.chartType),t.changePcnt=P(t.changePcntNumber,2),t.pricePreviousCloseLoc=function(e,t,n){const r=Se(e,t,n);return O(e,r)}(t.pricePreviousClose,t.currency,t.securityType)),t.displayName=de(e),t}function he(e,t,n){const r=e.items||[],i=r[r.length-1].close,s=n===a.oX.OneDayOneMinute&&void 0!==t?t:r[0].close;return 0===s?0:100*(i/s-1)}function me(e){var t;const n=le(e);return n.securityType=a.nc.Cryptocurrency,n.shortName=e.name,n.pricePreviousClose=null===(t=n.series.items[0])||void 0===t?void 0:t.open,n}function fe(e){const t=[];for(let n=0;n<e.timeStamps.length;n++)t.push({date:e.timeStamps&&ge(e.timeStamps[n]),open:e.openPrices&&ye(e.openPrices[n]),close:e.prices&&ye(e.prices[n]),high:e.pricesHigh&&ye(e.pricesHigh[n]),low:e.pricesLow&&ye(e.pricesLow[n]),volume:e.volumes&&ye(e.volumes[n])});return{priceHigh:e.priceHigh,priceLow:e.priceLow,startTime:ge(e.startTime),endTime:ge(e.endTime),items:t}}function de(e){return e.securityType==a.nc.Cryptocurrency?(null==e?void 0:e.name)||(null==e?void 0:e.displayName):e.securityType==a.nc.Currency?(null==e||null===(t=e.localizedAttributes)||void 0===t||null===(t=t[p.jG.CurrentMarket])||void 0===t?void 0:t.symbolName)??e.displayName:(null==e||null===(n=e.localizedAttributes)||void 0===n||null===(n=n[p.jG.CurrentMarket])||void 0===n?void 0:n.displayName)??e.displayName;var t,n}function pe(e){return e.securityType==a.nc.Cryptocurrency?(null==e?void 0:e.name)||(null==e?void 0:e.shortName):e.securityType==a.nc.Currency?(null==e||null===(t=e.localizedAttributes)||void 0===t||null===(t=t[p.jG.CurrentMarket])||void 0===t?void 0:t.symbolName)??e.shortName:null==e||null===(n=e.localizedAttributes)||void 0===n||null===(n=n[p.jG.CurrentMarket])||void 0===n?void 0:n.shortName;var t,n}function ge(e){return e?e.endsWith("Z")?new Date(e):new Date(e+"Z"):new Date}function ye(e){if(!("number"!=typeof e||e<0))return e}const ve=7;function we(e){return e.map((e=>e.instrumentId))}async function Te(e){const t=ce(q),n=p.jG.CurrentMarket;let i=null;if(e&&(i=await async function(e){if(!e||0===e.length)return[];const t=ce(H);t.search=y.c.keyValueArrayToQueryString([...y.c.getParams(p.jG.ContentServiceUrlBase.search),...ae(),...se(),{key:"ids",value:e.join(",")},{key:"wrapodata",value:"false"}]);const n=await ie("GET");n.cache="no-store";const i="getIndices",a=(0,T.w)((()=>B(t.href,n)),i),s=await re(a,i,t.href,r.Jus,r.M_5,r.O3,ne);if(!s)return[];return ee(s)}([e])),!i||!i[0]||!i[0].active&&!i[0].gainers&&!i[0].losers){const e=h[n]||l;t.search=y.c.keyValueArrayToQueryString([...y.c.getParams(p.jG.ContentServiceUrlBase.search),...ae(),...se(),{key:"ids",value:e},{key:"wrapodata",value:"false"}]);const a="getMostActiveQuotes",s=await ie("GET");s.cache="no-store";const o=(0,T.w)((async()=>B(t.href,s)),a);i=await re(o,a,t.href,r.GeL,r.nvX,r.rbA,(e=>ne(e)&&ne(e[0].active)))}return null==i?{active:[],gainers:[],losers:[]}:{active:we(i[0].active),gainers:we(i[0].gainers),losers:we(i[0].losers)}}function Ce(e){return e>=1?0:-1*Math.floor(Math.log(e)/Math.log(10)+1)}function Se(e,t,n){if("KRW"===t)return 0;if(e>=1)return 2;const r=n===a.nc.Currency?3:2,i=e>=.01?r:Ce(e)+2;return Math.max(r,i)}function xe(e){const t="KRW"===e.currency?0:2,n=Se(e.price,e.currency,e.securityType);return{id:e.instrumentId,quoteId:e.instrumentId,symbol:e.symbol,price:O(e.price,n),priceNumber:e.price,changeValue:F(e.priceChange,t),changeValueNumber:e.priceChange,changePcnt:P(e.priceChangePercent),changePcntNumber:e.priceChangePercent,displayName:de(e),exchangeName:e.exchangeName,exchangeId:e.exchangeId,quoteHref:e.quoteHref,formatedUpdateTime:L(e.timeLastUpdated),timeLastUpdated:new Date(e.timeLastUpdated),timeLastTraded:e.timeLastTraded,gain:e.priceChangePercent>0,unchanged:void 0===e.priceChangePercent||0===e.priceChangePercent,securityType:e.securityType,currency:e.currency,icon:e.icon,shortName:pe(e)}}const be=new(b())({maxAge:3e4,max:5e4,length:()=>50});async function ke(e){return u({action:"getQuoteDetails",ids:e,cacheStore:be,getCacheId:e=>`${p.jG.CurrentMarket}-${e}`,fetchData:e=>W(e),getItemId:Q,transformer:xe})}function Ne(e){const t=e?`${m}${e}`:m;return c.get(t)||c.set(t,Te(e)),c.get(t)}var Ee=n(76611),De=n(78672);class Ae{get __type_mapping(){return{RT00S:"realTimeSymbol",OS001:"equitySymbol",OS01W:"companyName",RT0SN:"shortName",FullInstrument:"fullInstrument",OS0LN:"longName",OS010:"entityType",OS01V:"languageCode",RT00T:"realTimeSecurityType",RT0EC:"realTimeCountryCode",ExMicCode:"realTimeMsListingExchangeCode",OS05J:"realTimeIsin",AC040:"exchangeName",RT00E:"realTimeExchange",LS01Z:"exchangeCode",FriendlyName:"friendlyName",DisplayName:"displayName",SecId:"quoteId"}}}async function Me(e,t){const n=p.jG.CurrentMarket||"en-us",i=`/api/v1/Query?query=${encodeURIComponent(e)}&market=${n}&count=${t}`;let a;try{a=await B(function(e,t,n){let r;return r=(0,De.zw)().startsWith("localhost.msn.com")?`https://${e}.${t}.microsoft-testing-falcon.io`:`https://services.bingapis.com/${t}.${e}`,r+n}("csautosuggest","contentservices-finance",i),{method:"GET"})}catch(i){return Ee.Xw.logExceptionWithFormat(i,r.Vak,"Error fetching finance auto suggest data v2","MoneyInfoService",`query: ${e}, market: ${n}, count: ${t}`),[]}if(!a||!a.ok)return[];let s=(await a.json()).data.stocks.map((e=>JSON.parse(e)));return f.includes(n)&&(s=s.filter((e=>"CR"!==e.OS010))),s.map((e=>function(e,t){const n="string"==typeof e?JSON.parse(e):e,r=new t;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(r.__type_mapping[e]?Reflect.set(r,r.__type_mapping[e],n[e]):Reflect.set(r,e,n[e]));return r}(e,Ae)))}var Oe=n(92378),Fe=n(83102),Ie=n(70169),Pe=n(19779);async function $e(e){try{return await Pe.N.updateSegmentCardsEnableStatus([{cardType:Oe.f.FinanceCard,enabled:e}]),!0}catch(e){return Ee.Xw.logExceptionWithFormat(e,r.OFV,"Finance user settings update failed","MoneyInfoService"),!1}}async function je(e){const t=null!=(n=e)&&d.test(n)?await z([e]):await W([e]);var n;return t[0]&&t[0].securityType?function(e){switch(e){case a.nc.Stocks:return 0;case a.nc.ETF:return 1;case a.nc.Indices:return 3;case a.nc.Funds:return 4;case a.nc.Currency:return 5;case a.nc.Commodity:return 6;default:return 0}}(t[0].securityType):0}async function Le(e,t,n={},i=!0){if(!(await(0,Ie.XJ)()===Fe.Hy.SignedIn)&&!i)return!1;if(!e)return Ee.Xw.logErrorWithFormat(r.Ecq,"Error adding to watchlist","QuoteId is undefined"),!1;const a=await Pe.N.addToWatchList(e,await je(e),t,n);return a||Ee.Xw.logErrorWithFormat(r.Ecq,"Error adding to watchlist","Add to watchlist request failed"),a}function Ge(e){const t=e&&e.analysis&&e.analysis.estimate;return t&&{...t,recommendation:a.qY[t.recommendation],dateLastUpdated:Re(e.analysis.estimate.dateLastUpdated),analystRecommendationNumber:t.analystRecommendation,numberOfPriceTargets:t.numberOfPriceTargets,pricevolatilityDateLastUpdated:Re(e.analysis.estimate.pricevolatilityDateLastUpdated),industryDateLastUpdated:Re(e.analysis.estimate.industryDateLastUpdated)}}function Re(e){return e?new Date(function(e){return e?(e.toLowerCase().endsWith("z")||(e+="Z"),Date.parse(e)):0}(e)):new Date}async function _e(e){return(await async function(e){if(!e||0===e.length)return Promise.resolve([]);const t=ce("Finance/Equities");t.search=y.c.keyValueArrayToQueryString([...ae(),{key:"ids",value:e.join(",")},{key:"wrapodata",value:"false"}]);const n=await ie("GET"),i="getEquities",a=(0,T.w)((()=>B(t.href,n)),i),s=await re(a,i,t.href,r.H_Z,r.rHL,r.IWG,ne);return null==s?[]:ee(s)}([e])).map(Ge)[0]}class qe{static aggregateChart(e,t,n,r){const{startTime:i,endTime:s,chartEndTime:o}=this.calculateTimes(e);let u=i.time;const c=this.generateTimeSpan(n);let l=[];const h=e.filter((e=>{var t;return(null===(t=e.series)||void 0===t||null===(t=t.items)||void 0===t?void 0:t.length)>0})).map((e=>{const t=e.series.items.filter((e=>e.date.getTime()>=i.time.getTime())).map((e=>({...e,timestamp:e.date.getTime()})));return{...e,series:{...e.series,startTimestamp:e.series.startTime.getTime(),endTimestamp:e.series.endTime.getTime(),items:t,sortedItems:[...t].sort(((e,t)=>t.timestamp-e.timestamp))}}}));for(;u.getTime()<=s.time.getTime();){if(!this.isCloseTime(e,u,n,c)){const e={date:u,close:0,open:0,high:0,low:0,volume:0,total:0},t=u.getTime();h.map((r=>{if(r.series.startTimestamp<=t&&(r.series.endTimestamp>=t||t-r.series.endTimestamp<=c)){let i=r.series.items[0].close;n!==a.oX.OneDayOneMinute&&n!==a.oX.OneDayFiveMinute||(i=r.pricePreviousClose);const s=r.series.sortedItems.find((e=>e.timestamp<=t));s&&(e.close+=s.close/i,e.total+=1)}})),e.total>0&&l.push({date:e.date,close:100*e.close/e.total-100})}const t=u.getTime();u=n!==a.oX.All?new Date(u.getTime()+c):this.nextMonthLastDay(u),t<s.time.getTime()&&u.getTime()>s.time.getTime()&&(u=s.time)}const m=l.map((e=>e.close)),f=Math.max(...m),d=Math.min(...m);if(r){const e=l[l.length-1],t=l.filter((t=>t.date.getFullYear()!==e.date.getFullYear())),n=l.filter((t=>t.date.getFullYear()===e.date.getFullYear()));if(t.length>0&&n.length>0){const e=t[t.length-1];l=n.map((t=>({date:t.date,close:t.close-e.close})))}}const p={startTime:i.time,endTime:o.time,items:l,priceHigh:f,priceLow:d};return{...e[0],pricePreviousClose:0,series:p,symbol:t,instrumentId:t}}static calculateTimes(e){const t=[],n=[],r=[];e.forEach((e=>{var i,a;if(null!=e&&null!==(i=e.series)&&void 0!==i&&i.endTime){const n=t.find((t=>t.time.getTime()===e.series.endTime.getTime()));n?n.total+=1:t.push({time:e.series.endTime,total:1}),t.sort(((e,t)=>t.time.getTime()-e.time.getTime()))}if((null==e||null===(a=e.series)||void 0===a||null===(a=a.items)||void 0===a?void 0:a.length)>0){const t=e.series.items,i=n.find((e=>e.time.getTime()===t[0].date.getTime()));i?i.total+=1:n.push({time:t[0].date,total:1}),n.sort(((e,t)=>t.time.getTime()-e.time.getTime()));const a=r.find((e=>e.time.getTime()===t[t.length-1].date.getTime()));a?a.total+=1:r.push({time:t[t.length-1].date,total:1}),r.sort(((e,t)=>t.time.getTime()-e.time.getTime()))}}));let i={...n[0]};n.forEach((e=>{e.total>i.total&&(i={...e})}));let a={...r[0]};r.forEach((e=>{e.total>=a.total&&(a={...e})}));let s={...t[0]};return t.forEach((e=>{e.total>=s.total&&(s={...e})})),{startTime:i,endTime:a,chartEndTime:s}}static generateTimeSpan(e){const t=6e4;switch(e){case a.oX.OneDayOneMinute:return t;case a.oX.OneDayFiveMinute:return 3e5;case a.oX.FiveDays:return 9e5;case a.oX.OneMonth:case a.oX.OneYear:return 864e5;case a.oX.FiveYear:return 6048e5;default:return t}}static isCloseTime(e,t,n,r){if(n===a.oX.OneDayFiveMinute||n==a.oX.OneDayOneMinute)return!1;let i=!1;if(n===a.oX.FiveDays){const n=[],a=[];if(e.forEach((e=>{var r;if((null==e||null===(r=e.series)||void 0===r?void 0:r.items.length)>0){const r=[...e.series.items],i=r.find((e=>e.date.getTime()>=t.getTime())),s=r.reverse().find((e=>e.date.getTime()<=t.getTime()));if(s){const e=n.find((e=>e.time.getTime()===s.date.getTime()));e?e.total+=1:n.push({time:s.date,total:1}),n.sort(((e,t)=>t.time.getTime()-e.time.getTime()))}if(i){const e=a.find((e=>e.time.getTime()===i.date.getTime()));e?e.total+=1:a.push({time:i.date,total:1}),a.sort(((e,t)=>t.time.getTime()-e.time.getTime()))}}})),n&&0!==n.length&&a&&0!==a.length){let e=n[0];n.forEach((t=>{t.total>=e.total&&(e={...t})}));let s=a[0];a.forEach((e=>{e.total>s.total&&(s={...e})})),(t.getTime()-e.time.getTime()>r||s.time.getTime()-t.getTime()>r)&&(i=!0)}else i=!0}return i}static nextMonthLastDay(e){let t=e.getFullYear(),n=e.getMonth()+2;return n>12&&(n-=12,t+=1),new Date(t,n,0,e.getHours(),e.getMinutes(),e.getSeconds())}}},73666:function(e,t,n){const r=n(51123),i=Symbol("max"),a=Symbol("length"),s=Symbol("lengthCalculator"),o=Symbol("allowStale"),u=Symbol("maxAge"),c=Symbol("dispose"),l=Symbol("noDisposeOnSet"),h=Symbol("lruList"),m=Symbol("cache"),f=Symbol("updateAgeOnGet"),d=()=>1;const p=(e,t,n)=>{const r=e[m].get(t);if(r){const t=r.value;if(g(e,t)){if(v(e,r),!e[o])return}else n&&(e[f]&&(r.value.now=Date.now()),e[h].unshiftNode(r));return t.value}},g=(e,t)=>{if(!t||!t.maxAge&&!e[u])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[u]&&n>e[u]},y=e=>{if(e[a]>e[i])for(let t=e[h].tail;e[a]>e[i]&&null!==t;){const n=t.prev;v(e,t),t=n}},v=(e,t)=>{if(t){const n=t.value;e[c]&&e[c](n.key,n.value),e[a]-=n.length,e[m].delete(n.key),e[h].removeNode(t)}};class w{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const T=(e,t,n,r)=>{let i=n.value;g(e,i)&&(v(e,n),e[o]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||d;if(this[s]="function"!=typeof t?d:t,this[o]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[u]=e.maxAge||0,this[c]=e.dispose,this[l]=e.noDisposeOnSet||!1,this[f]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,y(this)}get max(){return this[i]}set allowStale(e){this[o]=!!e}get allowStale(){return this[o]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[u]=e,y(this)}get maxAge(){return this[u]}set lengthCalculator(e){"function"!=typeof e&&(e=d),e!==this[s]&&(this[s]=e,this[a]=0,this[h].forEach((e=>{e.length=this[s](e.value,e.key),this[a]+=e.length}))),y(this)}get lengthCalculator(){return this[s]}get length(){return this[a]}get itemCount(){return this[h].length}rforEach(e,t){t=t||this;for(let n=this[h].tail;null!==n;){const r=n.prev;T(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[h].head;null!==n;){const r=n.next;T(this,e,n,t),n=r}}keys(){return this[h].toArray().map((e=>e.key))}values(){return this[h].toArray().map((e=>e.value))}reset(){this[c]&&this[h]&&this[h].length&&this[h].forEach((e=>this[c](e.key,e.value))),this[m]=new Map,this[h]=new r,this[a]=0}dump(){return this[h].map((e=>!g(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[h]}set(e,t,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,o=this[s](t,e);if(this[m].has(e)){if(o>this[i])return v(this,this[m].get(e)),!1;const s=this[m].get(e).value;return this[c]&&(this[l]||this[c](e,s.value)),s.now=r,s.maxAge=n,s.value=t,this[a]+=o-s.length,s.length=o,this.get(e),y(this),!0}const f=new w(e,t,o,r,n);return f.length>this[i]?(this[c]&&this[c](e,t),!1):(this[a]+=f.length,this[h].unshift(f),this[m].set(e,this[h].head),y(this),!0)}has(e){if(!this[m].has(e))return!1;const t=this[m].get(e).value;return!g(this,t)}get(e){return p(this,e,!0)}peek(e){return p(this,e,!1)}pop(){const e=this[h].tail;return e?(v(this,e),e.value):null}del(e){v(this,this[m].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[m].forEach(((e,t)=>p(this,t,!1)))}}},7876:function(e){e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},51123:function(e,t,n){function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t){e.tail=new s(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function a(e,t){e.head=new s(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function s(e,t,n,r){if(!(this instanceof s))return new s(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=s,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)i(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)n.push(a.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)n.push(a.value);return n},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n(7876)(r)}catch(e){}}}]);